<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solicitudes de Reservas - PRE-CANCHA</title>
    <link rel="stylesheet" href="estilos.css">
    <style>
        .solicitud-card {
            background: linear-gradient(145deg, var(--color-bg-light), #0d0d0d);
            border: 2px solid var(--color-primary);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .solicitud-card:hover {
            box-shadow: 0 8px 25px rgba(218, 165, 32, 0.4);
            transform: translateY(-3px);
        }

        .solicitud-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .solicitud-id {
            background: var(--color-primary);
            color: #000;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }

        .solicitud-estado {
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 12px;
            background: rgba(255, 215, 0, 0.2);
            color: #FFD700;
            border: 1px solid #FFD700;
        }

        .solicitud-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .info-item {
            background: rgba(218, 165, 32, 0.1);
            padding: 12px;
            border-radius: 8px;
            border-left: 3px solid var(--color-primary);
        }

        .info-label {
            color: var(--color-text-muted);
            font-size: 12px;
            text-transform: uppercase;
        }

        .info-value {
            color: var(--color-secondary);
            font-weight: bold;
            font-size: 16px;
            margin-top: 5px;
        }

        .solicitud-acciones {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-action {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn-aprobar {
            background: rgba(0, 255, 0, 0.2);
            color: #0f0;
            border: 1px solid #0f0;
        }

        .btn-aprobar:hover {
            background: rgba(0, 255, 0, 0.3);
            transform: scale(1.05);
        }

        .btn-rechazar {
            background: rgba(255, 68, 68, 0.2);
            color: #f44;
            border: 1px solid #f44;
        }

        .btn-rechazar:hover {
            background: rgba(255, 68, 68, 0.3);
            transform: scale(1.05);
        }

        .sin-solicitudes {
            text-align: center;
            padding: 40px;
            color: var(--color-text-muted);
        }

        .filtro-solicitudes {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .stats-solicitudes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(145deg, var(--color-bg-light), #0d0d0d);
            border: 2px solid var(--color-primary);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .stat-numero {
            font-size: 32px;
            font-weight: bold;
            color: var(--color-secondary);
        }

        .stat-label {
            color: var(--color-text-muted);
            font-size: 14px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- Header y Navegación -->
    <header>
        <nav>
            <div class="logo">PRE-CANCHA</div>
            <ul>
                <li><a href="index.html">Inicio</a></li>
                <li id="misReservasLink" style="display: none;">
                    <a href="mis_reservas.html">Mis Reservas</a>
                </li>
                <li id="solicitudesLink" style="display: none;">
                    <a href="solicitudes.html" style="color: #FFD700;">Solicitudes</a>
                </li>
                <li id="adminLink" style="display: none;">
                    <a href="admin.html">Panel Admin</a>
                </li>
                <li id="loginLink"><a href="login.html">Iniciar Sesión</a></li>
                <li id="userInfo" style="display: none;">
                    <span id="userName"></span>
                </li>
                <li id="logoutBtn" style="display: none;">
                    <button onclick="doLogout()" style="background: #DAA520; color: #000; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-weight: bold;">Cerrar Sesión</button>
                </li>
            </ul>
        </nav>
    </header>

    <!-- Main Content -->
    <main>
        <div class="container">
            <h1 style="margin-top: 80px; margin-bottom: 30px;">Solicitudes de Reservas</h1>

            <div id="accesoNegado" class="bienvenida" style="background: rgba(255, 68, 68, 0.1); border-color: #f44; display: none;">
                <h2 style="color: #f44;">Acceso Denegado</h2>
                <p>Solo los administradores pueden acceder a las solicitudes. <a href="index.html" style="color: #FFD700; text-decoration: underline;">Volver a inicio</a></p>
            </div>

            <div id="contenidoSolicitudes" style="display: none;">
                <!-- Estadísticas -->
                <div class="stats-solicitudes">
                    <div class="stat-card">
                        <div class="stat-numero" id="totalSolicitudes">0</div>
                        <div class="stat-label">Total de Solicitudes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-numero" style="color: #FFD700;" id="solicitudesPendientes">0</div>
                        <div class="stat-label">Pendientes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-numero" style="color: #0f0;" id="solicitudesAprobadas">0</div>
                        <div class="stat-label">Aprobadas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-numero" style="color: #f44;" id="solicitudesRechazadas">0</div>
                        <div class="stat-label">Rechazadas</div>
                    </div>
                </div>

                <!-- Filtros -->
                <div class="filtro-solicitudes">
                    <button class="tab-btn active" onclick="filtrarSolicitudes('pendiente')">Pendientes</button>
                    <button class="tab-btn" onclick="filtrarSolicitudes('todas')">Todas</button>
                    <button class="tab-btn" onclick="filtrarSolicitudes('confirmada')">Aprobadas</button>
                    <button class="tab-btn" onclick="filtrarSolicitudes('rechazada')">Rechazadas</button>
                </div>

                <!-- Solicitudes -->
                <div id="listaSolicitudes">
                    <!-- Se llena con JavaScript -->
                </div>

                <div id="sinSolicitudes" class="sin-solicitudes" style="display: none;">
                    <h3>No hay solicitudes en esta categoría</h3>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 PRE-CANCHA. Todos los derechos reservados. | Sistema de Reservas de Canchas</p>
    </footer>

    <script src="app.js"></script>
    <script>
        let filtroActual = 'pendiente';
        let todasLasReservas = [];

        function cargarPagina() {
            if (!session.isLogged()) {
                window.location.href = 'login.html';
                return;
            }

            const sesion = session.getSession();
            document.getElementById('userName').textContent = sesion.nombre;

            if (sesion.rol !== 'admin') {
                document.getElementById('accesoNegado').style.display = 'block';
                document.getElementById('contenidoSolicitudes').style.display = 'none';
                return;
            }

            document.getElementById('accesoNegado').style.display = 'none';
            document.getElementById('contenidoSolicitudes').style.display = 'block';
            document.getElementById('solicitudesLink').style.display = 'block';

            cargarEstadisticas();
            cargarSolicitudes();
        }

        function cargarEstadisticas() {
            const reservas = session.getReservas();
            todasLasReservas = reservas;

            const total = reservas.length;
            const pendientes = reservas.filter(r => r.estado === 'pendiente').length;
            const aprobadas = reservas.filter(r => r.estado === 'confirmada').length;
            const rechazadas = reservas.filter(r => r.estado === 'rechazada').length;

            document.getElementById('totalSolicitudes').textContent = total;
            document.getElementById('solicitudesPendientes').textContent = pendientes;
            document.getElementById('solicitudesAprobadas').textContent = aprobadas;
            document.getElementById('solicitudesRechazadas').textContent = rechazadas;
        }

        function cargarSolicitudes() {
            const usuarios = session.obtenerTodosLosUsuarios();
            const canchas = session.getCanchas();
            const listaSolicitudes = document.getElementById('listaSolicitudes');
            const sinSolicitudes = document.getElementById('sinSolicitudes');

            let solicitudes = todasLasReservas;

            if (filtroActual !== 'todas') {
                solicitudes = todasLasReservas.filter(r => r.estado === filtroActual);
            }

            if (solicitudes.length === 0) {
                listaSolicitudes.innerHTML = '';
                sinSolicitudes.style.display = 'block';
                return;
            }

            sinSolicitudes.style.display = 'none';
            listaSolicitudes.innerHTML = '';

            solicitudes.forEach(reserva => {
                const usuario = usuarios.find(u => u.id === reserva.usuario_id);
                const cancha = canchas.find(c => c.id === reserva.cancha_id);
                
                const card = document.createElement('div');
                card.className = 'solicitud-card';
                
                const estadoColor = {
                    'confirmada': '#0f0',
                    'pendiente': '#FFD700',
                    'rechazada': '#f44'
                };

                const botonesAccion = reserva.estado === 'pendiente' ? `
                    <button class="btn-action btn-aprobar" onclick="aprobarSolicitud(${reserva.id})">✓ Aprobar</button>
                    <button class="btn-action btn-rechazar" onclick="rechazarSolicitud(${reserva.id})">✗ Rechazar</button>
                ` : '';

                card.innerHTML = `
                    <div class="solicitud-header">
                        <div>
                            <span class="solicitud-id">ID: ${reserva.id}</span>
                        </div>
                        <span class="solicitud-estado" style="background: rgba(${
                            estadoColor[reserva.estado] === '#0f0' ? '0, 255, 0' :
                            estadoColor[reserva.estado] === '#FFD700' ? '255, 215, 0' :
                            '255, 68, 68'
                        }, 0.2); border-color: ${estadoColor[reserva.estado]}; color: ${estadoColor[reserva.estado]};">
                            ${reserva.estado.toUpperCase()}
                        </span>
                    </div>

                    <div class="solicitud-info">
                        <div class="info-item">
                            <div class="info-label">Usuario</div>
                            <div class="info-value">${usuario?.nombre || 'Desconocido'}</div>
                            <small style="color: #888;">${usuario?.email || 'N/A'}</small>
                        </div>

                        <div class="info-item">
                            <div class="info-label">Cancha</div>
                            <div class="info-value">Cancha ${cancha?.numero || 'N/A'}</div>
                            <small style="color: #888;">${cancha?.tipo || 'N/A'}</small>
                        </div>

                        <div class="info-item">
                            <div class="info-label">Fecha y Hora</div>
                            <div class="info-value">${new Date(reserva.fecha).toLocaleDateString('es-ES')}</div>
                            <small style="color: #888;">${reserva.hora_inicio} - ${reserva.hora_fin}</small>
                        </div>

                        <div class="info-item">
                            <div class="info-label">Monto</div>
                            <div class="info-value" style="color: #0f0;">$${cancha?.precio || 0}</div>
                            <small style="color: #888;">Por hora</small>
                        </div>
                    </div>

                    ${reserva.observaciones ? `
                        <div class="info-item">
                            <div class="info-label">Observaciones</div>
                            <div style="color: var(--color-text);">${reserva.observaciones}</div>
                        </div>
                    ` : ''}

                    <div class="solicitud-acciones">
                        ${botonesAccion}
                    </div>
                `;

                listaSolicitudes.appendChild(card);
            });
        }

        function filtrarSolicitudes(filtro) {
            filtroActual = filtro;

            // Actualizar botones activos
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            cargarSolicitudes();
        }

        function aprobarSolicitud(solicitud_id) {
            if (confirm('¿Estás seguro de que deseas aprobar esta solicitud?')) {
                const resultado = session.aprobarSolicitud(solicitud_id);
                if (resultado.success) {
                    alert('Solicitud aprobada exitosamente');
                    cargarEstadisticas();
                    cargarSolicitudes();
                } else {
                    alert('Error: ' + resultado.message);
                }
            }
        }

        function rechazarSolicitud(solicitud_id) {
            if (confirm('¿Estás seguro de que deseas rechazar esta solicitud?')) {
                const resultado = session.rechazarSolicitud(solicitud_id);
                if (resultado.success) {
                    alert('Solicitud rechazada');
                    cargarEstadisticas();
                    cargarSolicitudes();
                } else {
                    alert('Error: ' + resultado.message);
                }
            }
        }

        // Cargar contenido al iniciar
        cargarPagina();
    </script>
</body>
</html>
